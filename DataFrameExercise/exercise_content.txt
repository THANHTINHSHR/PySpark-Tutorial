🔥 Bài tập Spark tổng hợp: Xử lý dữ liệu bóng đá
Mục tiêu: Thực hành toàn bộ kiến thức Spark gồm I/O, Transformations (Narrow, Wide, UDFs, Window), Actions, Caching, SQL, Schema Metadata.

📌 Dữ liệu đã có:
player_raw.csv: Thông tin cầu thủ
score_raw.csv: Kết quả trận đấu
squad_raw.csv: Thông tin đội bóng
match_raw.csv: Chi tiết trận đấu
🔹 Bài tập 1: Đọc và kiểm tra dữ liệu
1️⃣ Đọc dữ liệu từ CSV vào DataFrame, đảm bảo:

Có header
Tự động suy luận schema (inferSchema=True)
Hiển thị 5 dòng đầu tiên
2️⃣ Kiểm tra metadata của DataFrame:

In schema (printSchema)
Lấy danh sách cột (columns)
Xem kiểu dữ liệu từng cột (dtypes)
Xem tóm tắt dữ liệu (describe)
🔹 Bài tập 2: Data Cleaning
1️⃣ Xóa dòng bị thiếu dữ liệu
2️⃣ Chuẩn hóa kiểu dữ liệu (convert số về Integer, ngày về Date,...)
3️⃣ Loại bỏ khoảng trắng dư thừa trong tên đội bóng, cầu thủ

🔹 Bài tập 3: Narrow Transformations
1️⃣ Thêm cột mới (withColumn)

Thêm cột season = 2023-2024 vào tất cả bảng
Chuyển tên cầu thủ, đội bóng thành chữ IN HOA
2️⃣ Filter dữ liệu (filter / where)

Lấy danh sách cầu thủ có số bàn thắng > 5
Lấy danh sách trận đấu có trên 50.000 khán giả
3️⃣ Select và rename cột (select / alias)

Lấy cột name, nation từ player_raw.csv và đổi tên thành player_name, country
🔹 Bài tập 4: Wide Transformations
1️⃣ Nhóm và tổng hợp dữ liệu (groupBy + agg)

Tính tổng số bàn thắng của từng đội bóng
Đếm số trận đấu của từng đội
2️⃣ Join dữ liệu (join)

Kết hợp match_raw với score_raw dựa trên match_id
Kết hợp player_raw với squad_raw để biết từng cầu thủ thuộc đội nào
🔹 Bài tập 5: UDFs (User Defined Functions)
1️⃣ Viết UDF chuyển đổi tên quốc gia từ viết tắt (ENG → England, FRA → France)
2️⃣ Viết UDF phân loại cầu thủ theo số bàn thắng:

>= 10 → "Siêu sao"
5-9 → "Trung bình"
<5 → "Dự bị"
🔹 Bài tập 6: Window Functions
1️⃣ Xếp hạng cầu thủ theo số bàn thắng trong mỗi đội (rank())
2️⃣ Tính tổng số bàn thắng của từng đội qua các vòng đấu (sum() + partitionBy)

🔹 Bài tập 7: SQL Operations
1️⃣ Đăng ký tất cả DataFrame thành bảng SQL (createOrReplaceTempView)
2️⃣ Viết truy vấn SQL:

Lấy danh sách cầu thủ có số bàn thắng cao nhất
Lấy 5 đội có số trận thắng nhiều nhất
Tính số trận đấu trung bình mỗi đội tham gia
🔹 Bài tập 8: Caching & Optimization
1️⃣ Cache DataFrame lớn và đo thời gian truy vấn trước/sau khi cache
2️⃣ Dùng broadcast join để tối ưu join giữa bảng nhỏ (player_raw) và bảng lớn (match_raw)

📌 Cách làm & Lưu ý
✅ Tạo file Python tương ứng (spark_reader.py, spark_transform.py, spark_sql.py...)
✅ Chạy thử từng phần, kiểm tra kết quả
✅ Log thời gian chạy để so sánh hiệu suất (time.time())

